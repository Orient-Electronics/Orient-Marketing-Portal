<%- model_class = Dealer -%>
<div class="page-header">
  <h1><%=t '.title', :default => model_class.model_name.human.pluralize.titleize %></h1>
</div>
<%= render :partial => "/shared/map", :locals => {:@shops => @dealers.collect(&:shops).flatten} %>
<div class="row-fluid">
  <div class="span12">
    <div class="box box-color box-bordered">
      <div class="box-title">
        <h3>
          Dealers
        </h3>
      </div>
      <div class="box-content nopadding">
        <table class="table table-hover table-nomargin" id="shop-data">
          <thead>
            <tr class='thefilter row-fluid'>
              <th class="span9"><input type="text" name="search_dealer" placeholder="Dealer" class="search_init span12" /></th>
              <th class="span3"><span class="span12">&nbsp;</span></th>
            </tr>
            <tr class="row-fluid">
              <th class="span9"><%= model_class.human_attribute_name(:name) %></th>
              <th class="span3"><%=t '.actions', :default => t("helpers.actions") %></th>
            </tr>
          </thead>
          <tbody>
            <% @dealers.each do |dealer| %>
              <tr class="row-fluid">
                <td class"span9"><%= link_to dealer.name, dealer_path(dealer) %></td>
                <td class"span3">
                  <%= link_to "<i class='icon-search'></i>".html_safe,
                              dealer_path(dealer), :class => 'btn', :rel=> "tooltip", :title =>"View" %>
                  <%= link_to "<i class='icon-edit'></i>".html_safe,
                              edit_dealer_path(dealer), :class => 'btn', :rel=> "tooltip", :title =>"Edit" %>
                  <%= link_to "<i class='icon-remove'></i>".html_safe,
                              dealer_path(dealer),
                              :method => :delete,
                              :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                              :class => 'btn', :rel=>"tooltip", :title=>"Delete" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<%= link_to t('.new', :default => t("helpers.links.new")),
            new_shop_path,
            :class => 'btn btn-primary' %>

<%= content_for :footer_js do %>
<script type="text/javascript" charset="utf-8">
  var asInitVals = new Array();
  
  $(document).ready(function() {
    var oTable = $('#shop-data').dataTable( {
      "oLanguage": {
        "sSearch": "Search all columns:"
      }
    } );
    
    $(".thefilter input").keyup( function () {
      /* Filter on the column (the index) of this element */
      oTable.fnFilter( this.value, $(".thefilter input").index(this) );
    } );
    
    
    
    /*
     * Support functions to provide a little bit of 'user friendlyness' to the textboxes in 
     * the footer
     */
    $(".thefilter input").each( function (i) {
      asInitVals[i] = this.value;
    } );
    
    $(".thefilter input").focus( function () {
      if ( this.className == "search_init" )
      {
        this.className = "";
        this.value = "";
      }
    } );
    
    $(".thefilter input").blur( function (i) {
      if ( this.value == "" )
      {
        this.className = "search_init";
        this.value = asInitVals[$(".thefilter input").index(this)];
      }
    } );
  } );
</script>
<% end -%>
