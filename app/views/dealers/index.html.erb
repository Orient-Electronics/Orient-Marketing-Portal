<%- model_class = Dealer -%>
<div class="page-header">
  <h1><%=t '.title', :default => model_class.model_name.human.pluralize.titleize %></h1>
</div>
<div id="modal-user" class="modal hide">
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal">Close</button>
  </div>
</div>
<div class="row-fluid">
  <div class="span6">
    <%= render :partial => "/shared/map" %>
  </div>
  <% if can? :read, Dealer%>
    <div class="span6">
      <div class="box box-color box-bordered">
        <div class="box-title">
        <h3>
          Dealers
        </h3>
        </div>
        <div class="box-content nopadding scrollable" style="overflow: hidden;">
          <table class="table table-hover table-nomargin" id="shop-data">
            <thead>
              <tr class='thefilter row-fluid'>
                <th class="span9"><input type="text" name="search_dealer" placeholder="Dealer" class="search_init span12" /></th>
                <th class="span3"><span class="span12">&nbsp;</span></th>
              </tr>
              <tr class="row-fluid">
              <th class="span9"><%= model_class.human_attribute_name(:name) %></th>
              <th class="span3"><%=t '.actions', :default => t("helpers.actions") %></th>
              </tr>
            </thead>
            <tbody>
            <% @dealers.each do |dealer| %>
              <% if can? :read, @dealers%>
                <tr class="row-fluid">
                <td class"span9"><%= link_to dealer.name, dealer_path(dealer) %></td>
                <td class"span3">
                  <%= link_to "<i class='icon-search'></i>".html_safe,
                              dealer_path(dealer), :class => 'btn', :rel=> "tooltip", :title =>"View" %>
                  <%= link_to "<i class='icon-edit'></i>".html_safe,
                              edit_dealer_path(dealer), :class => 'btn', :rel=> "tooltip", :title =>"Edit" %>
                  <%= link_to "<i class='icon-remove'></i>".html_safe,
                              dealer_path(dealer),
                              :method => :delete,
                              :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                              :class => 'btn', :rel=>"tooltip", :title=>"Delete" %>
                </td>
                </tr>
              <%end -%>  
            <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% end -%>
</div>  
<div class="row-fluid">
  <% if can? :read, Upload%>
      <div class="span6">
        <div class="box box-color box-bordered">
          <div class="box-title">
            <h3>
              <i class="icon-picture"></i>
              Images
            </h3>  
            <div class="actions">
              <%= link_to "View All", showgallery_dealers_path(), :class=> "btn btn-primary" %>
              <a href="#" class="btn btn-mini content-remove"><i class="icon-remove"></i></a>
            <a href="#" class="btn btn-mini content-slideUp"><i class="icon-angle-down"></i></a>
          </div>
         </div>
        <div class="box-content nopadding" >
          <ul class="gallery">
            <% @shops.collect(&:uploads).flatten.first(6).each do |image| %>
              <li>
                <a href="#">
                  <%= image_tag image.upload.url(:small) %>
                </a>
                <div class="extras">
                  <div class="extras-inner">
                    <a href="<%= image.upload.url(:medium) %>" class='colorbox-image' rel="group-1"><i class="icon-search"></i></a>
                    <a href="<%= image.to_jq_upload['delete_url'] %>" class='del-gallery-pic' data-method="delete"><i class="icon-trash"></i></a>
                  </div>
                </div>
              </li>
            <% end -%>
          </ul>
        </div>
      </div>
    </div>
  <% end -%>

  <% if can? :read, Owner, Manager%>
    <div class="span6">
      <div class="box box-color box-bordered">
        <div class="box-title">
          <h3>
            <i class="icon-user">
            People </i>
          </h3>
          <div class="actions">
            <a href="#" class="btn btn-mini content-remove"><i class="icon-remove"></i></a>
            <a href="#" class="btn btn-mini content-slideUp"><i class="icon-angle-down"></i></a>
          </div>
        </div>
        <div class="box-content nopadding scrollable" data-height="500" data-visible="true"   >
          <table class="table table-user table-nohead">
            <tbody  remote ="true">
              <% @shops.each do |shop| %>
                <tr>
                  <% unless shop.owner.blank? %>
                    <td class ="img"><img src="/assets/demo/user-1.jpg" alt=""></td>
                    <td class="user"><%= shop.owner.name %></td>
                    <td class='icon search_btn' data-id = <%= shop.id%> data-type = "owner" ><a href="#" class='btn'><i class="icon-search"></i></a></td>
                  <% end -%>
                </tr>    
                <tr>
                  <% unless shop.manager.blank? %>
                    <td class ="img"><img src="/assets/demo/user-2.jpg" alt=""></td>
                    <td class="user"><%= shop.manager.name %></td>
                    <td class='icon search_btn' data-id =  <%= shop.id%> data-type = "manager" ><a href="#" class='btn'><i class="icon-search"></i></a></td>
                  <% end -%>
                </tr>
              <% end -%>  
            </tbody>
          </table>    
        </div>
      </div>
    </div>
  <%end -%>
</div>

<%= content_for :footer_js do %>
  <script type="text/javascript" charset="utf-8">
    var asInitVals = new Array();
    
    $(document).ready(function() {
      var oTable = $('#shop-data').dataTable();
      
      $(".thefilter input").keyup( function () {
        /* Filter on the column (the index) of this element */
        oTable.fnFilter( this.value, $(".thefilter input").index(this) );
      } );
      
      /*
       * Support functions to provide a little bit of 'user friendlyness' to the textboxes in 
       * the footer
       */
      $(".thefilter input").each( function (i) {
        asInitVals[i] = this.value;
      } );
      
      $(".thefilter input").focus( function () {
        if ( this.className == "search_init" )
        {
          this.className = "";
          this.value = "";
        }
      } );
      
      $(".thefilter input").blur( function (i) {
        if ( this.value == "" )
        {
          this.className = "search_init";
          this.value = asInitVals[$(".thefilter input").index(this)];
        }
      } );

      $(".search_btn").click( function ()
        {
          id = $(this).data("id");
          type = $(this).data("type")
            $.ajax ({
            url:  '/dealers/' + id + '/showmodal',
            data: {type: type},
            success: function(data)
            {                              
              $("#modal-user").html(data);
            }
          });
        });
    } );
  </script>
<% end -%>
