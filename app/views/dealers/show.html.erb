<div class="content-header">
  <div class="header-section">
    <div class="button-group pull-right">
      <a href="/shops/new" class="btn btn-large btn-primary" style="margin-top:20px;"> Add Shop </a>
    </div>
    <h1>
      Dealers
    </h1>
  </div>
</div>
<div class="content-header">
  <div class="header-section">
    <div class="btn-toolbar pull-right">
    </div>  
    <h1>
      Shop
    </h1>
  </div>
</div>

<div id="modal-user" class="modal">
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal">Close</button>
  </div>
</div>
<a href="#modal-user" data-toggle="modal" class="person-inform-link"></a>
<div class="row">
  <div class="col-md-6">
    <%= render :partial => "/shared/map"%>
  </div>
  <% if can? :read, Shop%>
    <div class="col-md-6">
      <div class="block block-color block-bordered">
        <div class="block-title">
          <h3>
            Shops
          </h3>
        </div>
        <div class="block-content nopadding scrollable" style="overflow: hidden;height:500px;">
          <table class="table table-hover table-nomargin" id="shop-data">
            <thead>
              <tr class='thefilter row'>
                <th class="col-md-6"><input type="text" name="search_shop" placeholder="Shop" class="search_init col-md-12" /></th>
                <th class="col-md-3"><input type="text" name="search_orient_dealer" placeholder="Orient Dealer" class="search_init col-md-12" /></th>
                <th class="col-md-3"><input type="text" name="search_city" placeholder="City" class="search_init col-md-12" /></th>
                <th class="col-md-3"><span class="col-md-12">&nbsp;</span></th>
              </tr>
              <tr class="row">
                <th class="col-md-6"> Dealer Name </th>
                <th class="col-md-3"> Orient Dealer </th>
                <th class="col-md-3"> City </th>
                <th class="col-md-3"> Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @shops.each do |shop| %>
                <% if can? :read, shop%>
                  <tr class="row">
                  <td class"span2"><%= link_to shop.dealer_name, shop_path(shop) %></td>
                  <td class"span1"><%= shop.orient_dealer ? "<span class='label label-satgreen'>Dealer</span>".html_safe : "<span class='label label-lightred'>Non dealer</span>".html_safe %></td>
                  <td class"span1"><%= shop.location.city.name %></td>
                  <td class"span2">
                    <%= link_to "<i class='icon-search'></i>".html_safe,
                                shop_path(shop), :class => 'btn', :rel=> "tooltip", :title =>"View" %>
                    <%= link_to "<i class='icon-edit'></i>".html_safe,
                                edit_shop_path(shop), :class => 'btn', :rel=> "tooltip", :title =>"Edit" %>
                    <%= link_to "<i class='icon-remove'></i>".html_safe,
                                shop_path(shop),
                                :method => :delete,
                                :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                                :class => 'btn', :rel=>"tooltip", :title=>"Delete" %>
                  </td>
                  </tr>
                <% end %>  
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% end -%> 
</div>
<div class="row">
  <% if can? :read, Report %>
    <div class="col-md-12">
      <div class="block">
        <div class="block-title">
          <h3><strong> Display &amp; Corner  Report</strong></h3>
          <ul class="nav nav-tabs" data-toggle="tabs">
            <li class="active"><a class="brand-tab" href="#brand-display-data">Brands</a></li>
            <li><a class="category-tab" href="#category-display-data">Categories</a></li>
          </ul>
        </div>  
        <div class="block-content">
          <div class="tab-content">
           <div class="tab-pane active" id="brand-display-data">
              <%= render :partial => "/svrs/brand_bar", :locals => {:brands => @brands, :reports => @reports} %>
           </div>
           <div class="tab-pane active" id="category-display-data">
              <%= render :partial => "/svrs/category_bar", :locals => {:categories => @categories, :reports => @reports, :type => "display_data", :brand => nil} %>
           </div> 
          </div>
        </div>  
      </div>  
    </div>
  <% end %>
</div>
<div class="row">
  <div class="col-md-6">
    <div class="block">
      <div class="block-title">
        <h2><strong>Display Corner Report</strong></h2>
        <ul class="nav nav-tabs" data-toggle="tabs">
          <li class="active"><a href="#corner_brand">Brands</a></li>
          <li><a href="#corner_category">Categories</a></li>
        </ul>
      </div>  
      <div class="tab-content">
        <div class="tab-pane active" id="corner_brand">
          <div class="gallery" data-toggle="lightbox-gallery">
            <% @corner_brand_report_lines.each do |brand_id,brand_report| %>
              <div class="row">
                <% brand_report.each do |line| %>
                  <% line.avatars.each do |upload| %>
                    <div class="col-sm-4 gallery-image">
                      <% if upload.avatar %>
                        <%= image_tag upload.avatar.url %>
                        <div class="gallery-image-options text-center">
                          <div class="btn-group btn-group-sm">
                            <a href="<%= upload.avatar.url(:medium) %>" class="gallery-link btn btn-sm btn-alt btn-default" title="Image Info">View</a>
                          </div>
                        </div>
                      <% else %>
                        <%= image_tag "/assets/default.png"%>
                        <div class="gallery-image-options text-center">
                          <div class="btn-group btn-group-sm">
                            <a href="<%= upload.avatar.url %>" class="gallery-link btn btn-sm btn-alt btn-default" title="Image Info">View</a>
                          </div>
                        </div>
                      <% end%>
                    </div>  
                  <% end %>  
                <% end %>  
              </div>  
            <% end %>
          </div>  
        </div>
        <div class="tab-pane" id="corner_category">
          <div class="gallery" data-toggle="lightbox-gallery">
            <% @corner_category_report_lines.each do |category,cat_report| %>
              <div class="row">
                <% cat_report.each do |line| %>
                  <% line.avatars.each do |upload| %>
                    <div class="col-sm-4 gallery-image">
                      <% if upload.avatar %>
                        <%= image_tag upload.avatar.url %>
                        <div class="gallery-image-options text-center">
                          <div class="btn-group btn-group-sm">
                            <a href="<%= upload.avatar.url %>" class="gallery-link btn btn-sm btn-alt btn-default" title="Image Info">View</a>
                          </div>
                        </div>
                      <% else %>
                        <%= image_tag "/assets/default.png"%>
                        <div class="gallery-image-options text-center">
                          <div class="btn-group btn-group-sm">
                            <a href="<%= upload.avatar.url %>" class="gallery-link btn btn-sm btn-alt btn-default" title="Image Info">View</a>
                          </div>
                        </div>
                      <% end%>
                    </div>  
                  <% end %>  
                <% end %>  
              </div>  
            <% end %>
          </div>
        </div>
      </div>  
    </div>
  </div>
  <div class="col-md-6">
    <div class="block">
      <div class="block-title">
        <h2>Images</h2>
      </div>
      <div class="gallery" data-toggle="lightbox-gallery">
        <div class="row">
          <% count = 0%>
          <% @uploads.each do |image| %>
            <% break if count == 9  %>
            <div class="col-sm-4 gallery-image">
              <% if image.class.to_s == "Upload"%>
                <%= image_tag image.upload.url(:small) %>
                <div class="gallery-image-options text-center">
                  <div class="btn-group btn-group-sm">
                    <a href="<%= image.upload.url(:medium)%>" class="gallery-link btn btn-sm btn-alt btn-default" title="Image Info">View</a>
                  </div>
                </div>      
              <% else %>
                <%= image_tag image.avatar.url(:small) %>
                <div class="gallery-image-options text-center">
                  <div class="btn-group btn-group-sm">
                    <a href="<%= image.avatar.url(:medium)%>" class="gallery-link btn btn-sm btn-alt btn-default" title="Image Info">View</a>
                  </div> 
                </div>  
              <% end %>
            </div>  
            <% count = count+1 %>
          <% end %>
        </div>  
      </div>
    </div>
  </div>
</div> 
  
<div class= "row">
  <% if can? :read, Owner, Manager %>
    <div class="col-md-6">
      <div class="block block-color block-bordered">
        <div class="block-title">
          <h3>
            <i class="icon-user">
            People </i>
          </h3>
          <div class="actions">
            <a href="#" class="btn btn-mini content-refresh"><i class="icon-refresh"></i></a>
            <a href="#" class="btn btn-mini content-remove"><i class="icon-remove"></i></a>
            <a href="#" class="btn btn-mini content-slideUp"><i class="icon-angle-down"></i></a>
          </div>
        </div>
        <div class="block-content nopadding scrollable" data-height="500" data-visible="true" >
          <table class="table table-user table-nohead">
            <tbody  remote ="true">
              <% @parent.shops.each do |shop| %>
                <tr>
                  <% unless shop.owner.blank? %>
                    <td class ="img"><img src="/assets/demo/user-1.jpg" alt=""></td>
                    <td class="user"><%= shop.owner.name %></td>
                    <td class='icon search_btn' data-id = <%= shop.id%> data-type = "owner" ><a href="#" class='btn'><i class="fa fa-search"></i></a></td>
                  <% end -%>
                </tr>    
                <tr>
                  <% unless shop.manager.blank? %>
                    <td class ="img"><img src="/assets/demo/user-2.jpg" alt=""></td>
                    <td class="user"><%= shop.manager.name %></td>
                    <td class='icon search_btn' data-id =  <%= shop.id%> data-type = "manager" ><a href="#" class='btn'><i class="fa fa-search"></i></a></td>
                  <% end -%>
                </tr>
              <% end -%>  
            </tbody>
          </table>    
        </div>
      </div>
    </div>
  <% end -%>
</div>
 
<%= content_for :footer_js do %>
  <script type="text/javascript" charset="utf-8">
    var asInitVals = new Array();
    
    $(document).ready(function() {
      var oTable = $('#shop-data').dataTable();
      
      $(".thefilter input").keyup( function () {
        /* Filter on the column (the index) of this element */
        oTable.fnFilter( this.value, $(".thefilter input").index(this) );
      } );
      
      
      
      /*
       * Support functions to provide a little bit of 'user friendlyness' to the textblockes in 
       * the footer
       */
      $(".thefilter input").each( function (i) {
        asInitVals[i] = this.value;
      } );
      
      $(".thefilter input").focus( function () {
        if ( this.className == "search_init" )
        {
          this.className = "";
          this.value = "";
        }
      } );
      
      $(".thefilter input").blur( function (i) {
        if ( this.value == "" )
        {
          this.className = "search_init";
          this.value = asInitVals[$(".thefilter input").index(this)];
        }
      } );
     
      $(".search_btn").click( function ()
        {
          id = $(this).data("id");
          type = $(this).data("type")
          $.ajax ({
            url:  '/dealers/' + id + '/showmodal',
            data: {type: type},
            success: function(data)
            {                              
              $("#modal-user").html(data);
              $(".person-inform-link").click();
            }
          });
        });  
    });
  </script>
<% end -%>

