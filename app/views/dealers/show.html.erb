<%- model_class = Dealer -%>
<div class="page-header">
  <h1><%= "#{@parent.name} - " if @parent.present? %><%=t '.title', :default => model_class.model_name.human.pluralize.titleize %></h1>
</div>
<div class="row-fluid">
  <div class="span6">
    <div class="box box-color box-bordered">
      <div class="box-title">
        <h3>
          <i class="icon-map-marker"></i>
          People
        </h3>
        <div class="actions">
          <a href="#" class="btn btn-mini content-remove"><i class="icon-remove"></i></a>
          <a href="#" class="btn btn-mini content-slideUp"><i class="icon-angle-down"></i></a>
        </div>
      </div>
      <div class="box-content" style="padding:0px;">
        <ul class="userlist">
          <% @parent.shops.each do |shop| %>
            <li class="alert alert-error" style="margin:0;"><%= shop.dealer_name %></li>
            <% unless shop.owner.blank? %>
              <li>
                <a href="#" >
                  <img src="/assets/demo/user-1.jpg" alt="">
                </a>
                <a href="#" rel="popover" title="" data-placement="top" data-content="<strong>Cell Number : <%= shop.owner.cell_number %></strong><br><strong>DOB : <%= shop.owner.dob %></strong>" data-original-title="<%= shop.owner.name %>" data-html="true" style="float:none;">
                  <div class="user">
                    <span class="name">
                      <%= shop.owner.name %>
                    </span>
                    <span class="position">
                      Owner
                    </span>
                  </div>
                  <div class="status active">
                    <i class="icon-circle"></i>
                  </div>
                </a>
              </li>
            <% end -%>
            <% unless shop.manager.blank? %>
              <li>
                <a href="#" >
                  <img src="/assets/demo/user-2.jpg" alt="">
                </a>
                <a href="#" rel="popover" title="" data-placement="top" data-content="<strong>Cell Number : <%= shop.manager.cell_number %></strong><br><strong>DOB : <%= shop.manager.dob %></strong>" data-original-title="<%= shop.manager.name %>" data-html="true" style="float:none;">
                  <div class="user">
                    <span class="name">
                      <%= shop.manager.name %>
                    </span>
                    <span class="position">
                      Manager
                    </span>
                  </div>
                  <div class="status afk">
                    <i class="icon-circle"></i>
                  </div>
                </a>
              </li>
            <% end -%>
          <% end -%>
        </ul>
      </div>
    </div>
  </div>
  <div class="span6">
    <%= render :partial => "/shared/map" %>
  </div>
</div>
<div class="row-fluid">
  <div class="span12">
    <div class="box box-color box-bordered">
      <div class="box-title">
        <h3>
          Shops
        </h3>
      </div>
      <div class="box-content nopadding">
        <table class="table table-hover table-nomargin" id="shop-data">
          <thead>
            <tr class='thefilter row-fluid'>
              <th class="span2"><input type="text" name="search_shop" placeholder="Shop" class="search_init span12" /></th>
              <th class="span1"><input type="text" name="search_phone" placeholder="Phone" class="search_init span12" /></th>
              <th class="span1"><input type="text" name="search_address" placeholder="Address" class="search_init span12" /></th>
              <th class="span1"><input type="text" name="search_dealer" placeholder="Dealer" class="search_init span12" /></th>
              <th class="span2"><input type="text" name="search_category" placeholder="Category" class="search_init span12" /></th>
              <th class="span2"><input type="text" name="search_location" placeholder="Location" class="search_init span12" /></th>
              <th class="span1"><input type="text" name="search_orient_dealer" placeholder="Orient Dealer" class="search_init span12" /></th>
              <th class="span2"><span class="span12">&nbsp;</span></th>
            </tr>
            <tr class="row-fluid">
              <th class="span2"><%= model_class.human_attribute_name(:dealer_name) %></th>
              <th class="span1"><%= model_class.human_attribute_name(:phone) %></th>
              <th class="span1"><%= model_class.human_attribute_name(:address) %></th>
              <th class="span1"><%= model_class.human_attribute_name(:dealer) %></th>
              <th class="span2"><%= model_class.human_attribute_name(:shop_category_id) %></th>
              <th class="span2"><%= model_class.human_attribute_name(:location_id) %></th>
              <th class="span1"><%= model_class.human_attribute_name(:orient_dealer) %></th>
              <th class="span2"><%=t '.actions', :default => t("helpers.actions") %></th>
            </tr>
          </thead>
          <tbody>
            <% @shops.each do |shop| %>
              <tr class="row-fluid">
                <td class"span2"><%= link_to shop.dealer_name, shop_path(shop) %></td>
                <td class"span1"><%= shop.phone %></td>
                <td class"span1"><%= shop.address %></td>
                <td class"span1"><%= link_to shop.dealer.try(:name), dealer_shops_path(shop.dealer) if shop.dealer.present? %></td>
                <td class"span2"><%= link_to shop.shop_category.try(:name), shop_category_shops_path(shop.shop_category) %></td>
                <td class"span2"><%= shop.location.try(:complete_location) %></td>
                <td class"span1"><%= shop.orient_dealer ? "<span class='label label-satgreen'>Yes</span>".html_safe : "<span class='label label-lightred'>No</span>".html_safe %></td>
                <td class"span2">
                  <%= link_to "<i class='icon-search'></i>".html_safe,
                              shop_path(shop), :class => 'btn', :rel=> "tooltip", :title =>"View" %>
                  <%= link_to "<i class='icon-edit'></i>".html_safe,
                              edit_shop_path(shop), :class => 'btn', :rel=> "tooltip", :title =>"Edit" %>
                  <%= link_to "<i class='icon-remove'></i>".html_safe,
                              shop_path(shop),
                              :method => :delete,
                              :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                              :class => 'btn', :rel=>"tooltip", :title=>"Delete" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="row-fluid">
  <div class="span6">
    <div class="box box-color box-bordered">
      <div class="box-title">
        <h3>
          <i class="icon-picture"></i>
          Images
        </h3>
        <div class="actions">
          <%= link_to "View All", gallery_dealer_path(@parent), :class=> "btn btn-primary" %>
          <a href="#" class="btn btn-mini content-remove"><i class="icon-remove"></i></a>
          <a href="#" class="btn btn-mini content-slideUp"><i class="icon-angle-down"></i></a>
        </div>
      </div>
      <div class="box-content nopadding">
        <ul class="gallery">
          <% @parent.shops.collect(&:uploads).flatten.first(6).each do |image| %>
            <li>
              <a href="#">
                <%= image_tag image.upload.url(:small) %>
              </a>
              <div class="extras">
                <div class="extras-inner">
                  <a href="<%= image.upload.url(:medium) %>" class='colorbox-image' rel="group-1"><i class="icon-search"></i></a>
                  <a href="<%= image.to_jq_upload['delete_url'] %>" class='del-gallery-pic' data-method="delete"><i class="icon-trash"></i></a>
                </div>
              </div>
            </li>
          <% end -%>
        </ul>
      </div>
    </div>
  </div>
  <div class="span6">
    <div class="box box-color box-bordered">
      <div class="box-title">
        <h3>
          <i class="icon-bar-chart"></i>
          Disaplay Report
        </h3>
        <div class="actions">
          <a href="#" class="btn btn-mini content-slideUp"><i class="icon-angle-down"></i></a>
        </div>
        <ul class="tabs">
          <li class="active">
            <a href="#brand-display-data" data-toggle="tab">Brand Data</a>
          </li>
          <li class="">
            <a href="#category-display-data" data-toggle="tab">Category Data</a>
          </li>
        </ul>
      </div>
      <div class="box-content">
        <div class="tab-content">
          <div class="tab-pane active" id="brand-display-data">
            <%= form_for :search,:url => brand_search_reports_path, :html => {:class => "report-search", "data-unit"=> "display_data"}, :method => :post do |f| %>
              <%= f.hidden_field :type, :value => "display_data" %>
              <%= hidden_field_tag "dealer_id", @parent.id %>
              <select name=search[product]>
                <option value="">All</option>
                <% ProductCategory.all.each do |pc| %>
                  <% if pc.products.blank? %>
                    <option value="<%= pc.name %>"><%= pc.name %></option>
                  <% else %>
                    <optgroup label="<%= pc.name %>">
                      <% pc.products.each do |product| %>
                        <option value="<%= product.name %>"><%= product.name %></option>
                      <% end -%>
                    </optgroup>
                  <% end -%>
                 
                <% end -%>
              </select>
              <%= f.select :week , options_for_select(year_weeks),{},{:class => "span6" , :multiple => :true, "data-selected-text-format"=>"count>5"} %>
            <% end -%>
            <div class="display_data_chart">
              <%= render :partial => "/reports/bar", :locals => {:brands => Brand.all, :reports => @parent.shops.collect(&:reports).flatten, :type => "display_data"} %>
            </div>
          </div>
          <div class="tab-pane active" id="category-display-data">
            <%= form_for :search,:url => category_search_reports_path, :html => {:class => "category-report-search", "data-unit"=> "display_data"}, :method => :post do |f| %>
              <%= f.hidden_field :type, :value => "display_data" %>
              <%= hidden_field_tag "dealer_id", @parent.id %>
              <select name=search[brand]>
                <option value="">All</option>
                <% Brand.all.each do |pc| %>
                  <option value="<%= pc.id %>"><%= pc.name %></option>
                <% end -%>
              </select>
              <%= f.select :week , options_for_select(year_weeks),{},{:class => "span6" , :multiple => :true, "data-selected-text-format"=>"count>5"} %>
            <% end -%>
            <div class="display_category_data_chart">
              <%= render :partial => "/reports/category_bar", :locals => {:categories => ProductCategory.all, :reports => @parent.shops.collect(&:reports).flatten, :type => "display_data"} %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row-fluid">
  <div class="span6">
    <div class="box box-color box-bordered">
      <div class="box-title">
        <h3>
          <i class="icon-bar-chart"></i>
          Sales Report
        </h3>
        <div class="actions">
          <a href="#" class="btn btn-mini content-slideUp"><i class="icon-angle-down"></i></a>
        </div>
        <ul class="tabs">
          <li class="active">
            <a href="#brand-sales-data" data-toggle="tab">Brand Data</a>
          </li>
          <li class="">
            <a href="#category-sales-data" data-toggle="tab">Category Data</a>
          </li>
        </ul>
      </div>
      <div class="box-content">
        <div class="tab-content">
          <div class="tab-pane active" id="brand-sales-data">
            <%= form_for :search,:url => brand_search_reports_path, :html => {:class => "report-search", "data-unit"=> "sales_data"}, :method => :post do |f| %>
              <%= f.hidden_field :type, :value => "sales_data" %>
              <%= hidden_field_tag "dealer_id", @parent.id %>
              <select name=search[product]>
                <option value="">All</option>
                <% ProductCategory.all.each do |pc| %>
                  <% if pc.products.blank? %>
                    <option value="<%= pc.name %>"><%= pc.name %></option>
                  <% else %>
                    <optgroup label="<%= pc.name %>">
                      <% pc.products.each do |product| %>
                        <option value="<%= product.name %>"><%= product.name %></option>
                      <% end -%>
                    </optgroup>
                  <% end -%>
                 
                <% end -%>
              </select>
              <%= f.select :week , options_for_select(year_weeks),{},{:class => "span6" , :multiple => :true, "data-selected-text-format"=>"count>5"} %>
            <% end -%>
            <div class="sales_data_chart">
              <%= render :partial => "/reports/bar", :locals => {:brands => Brand.all, :reports => @parent.shops.collect(&:reports).flatten, :type => "sales_data"} %>
            </div>
          </div>
          <div class="tab-pane active" id="category-sales-data">
            <%= form_for :search,:url => category_search_reports_path, :html => {:class => "category-report-search", "data-unit"=> "sales_data"}, :method => :post do |f| %>
              <%= f.hidden_field :type, :value => "sales_data" %>
              <%= hidden_field_tag "dealer_id", @parent.id %>
              <select name=search[brand]>
                <option value="">All</option>
                <% Brand.all.each do |pc| %>
                  <option value="<%= pc.id %>"><%= pc.name %></option>
                <% end -%>
              </select>
              <%= f.select :week , options_for_select(year_weeks),{},{:class => "span6" , :multiple => :true, "data-selected-text-format"=>"count>5"} %>
            <% end -%>
            <div class="sales_category_data_chart">
              <%= render :partial => "/reports/category_bar", :locals => {:categories => ProductCategory.all, :reports => @parent.shops.collect(&:reports).flatten, :type => "sales_data"} %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="span6">
    <div class="box box-color box-bordered">
      <div class="box-title">
        <h3>
          <i class="icon-bar-chart"></i>
          Disaplay Corner
        </h3>
        <div class="actions">
          <a href="#" class="btn btn-mini content-slideUp"><i class="icon-angle-down"></i></a>
        </div>
        <ul class="tabs">
          <li class="active">
            <a href="#brand-corner-data" data-toggle="tab">Brand Data</a>
          </li>
          <li class="">
            <a href="#category-corner-data" data-toggle="tab">Category Data</a>
          </li>
        </ul>
      </div>
      <div class="box-content">
        <div class="tab-content">
          <div class="tab-pane active" id="brand-corner-data">
            <%= form_for :search,:url => brand_search_reports_path, :html => {:class => "report-search", "data-unit"=> "corner_data"}, :method => :post do |f| %>
              <%= f.hidden_field :type, :value => "corner_data" %>
              <%= hidden_field_tag "dealer_id", @parent.id %>
              <select name=search[product]>
                <option value="">All</option>
                <% ProductCategory.all.each do |pc| %>
                  <% if pc.products.blank? %>
                    <option value="<%= pc.name %>"><%= pc.name %></option>
                  <% else %>
                    <optgroup label="<%= pc.name %>">
                      <% pc.products.each do |product| %>
                        <option value="<%= product.name %>"><%= product.name %></option>
                      <% end -%>
                    </optgroup>
                  <% end -%>
                 
                <% end -%>
              </select>
              <%= f.select :week , options_for_select(year_weeks),{},{:class => "span6" , :multiple => :true, "data-selected-text-format"=>"count>5"} %>
            <% end -%>
            <div class="display_data_chart">
              <%= render :partial => "/reports/bar", :locals => {:brands => Brand.all, :reports => @parent.shops.collect(&:reports).flatten, :type => "corner_data"} %>
            </div>
          </div>
          <div class="tab-pane active" id="category-corner-data">
            <%= form_for :search,:url => category_search_reports_path, :html => {:class => "category-report-search", "data-unit"=> "corner_data"}, :method => :post do |f| %>
              <%= f.hidden_field :type, :value => "corner_data" %>
              <%= hidden_field_tag "dealer_id", @parent.id %>
              <select name=search[brand]>
                <option value="">All</option>
                <% Brand.all.each do |pc| %>
                  <option value="<%= pc.id %>"><%= pc.name %></option>
                <% end -%>
              </select>
              <%= f.select :week , options_for_select(year_weeks),{},{:class => "span6" , :multiple => :true, "data-selected-text-format"=>"count>5"} %>
            <% end -%>
            <div class="corner_category_data_chart">
              <%= render :partial => "/reports/category_bar", :locals => {:categories => ProductCategory.all, :reports => @parent.shops.collect(&:reports).flatten, :type => "corner_data"} %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<%= content_for :footer_js do %>
<script type="text/javascript" charset="utf-8">
  var asInitVals = new Array();
  
  $(document).ready(function() {
    var oTable = $('#shop-data').dataTable( {
      "oLanguage": {
        "sSearch": "Search all columns:"
      }
    } );
    
    $(".thefilter input").keyup( function () {
      /* Filter on the column (the index) of this element */
      oTable.fnFilter( this.value, $(".thefilter input").index(this) );
    } );
    
    
    
    /*
     * Support functions to provide a little bit of 'user friendlyness' to the textboxes in 
     * the footer
     */
    $(".thefilter input").each( function (i) {
      asInitVals[i] = this.value;
    } );
    
    $(".thefilter input").focus( function () {
      if ( this.className == "search_init" )
      {
        this.className = "";
        this.value = "";
      }
    } );
    
    $(".thefilter input").blur( function (i) {
      if ( this.value == "" )
      {
        this.className = "search_init";
        this.value = asInitVals[$(".thefilter input").index(this)];
      }
    } );
    $('.report-search').ajaxForm({
        success: showResponse
      });
    $('.report-search select').change(function(){
      $(this).parent().submit();
    });
    $('.category-report-search').ajaxForm({
        success: showCatResponse
      });
    $('.category-report-search select').change(function(){
      $(this).parent().submit();
    });
    $('#category-display-data,#category-sales-data,#category-corner-data').removeClass('active');
  } );
</script>
<% end -%>

